#!/bin/bash
#=== 确保清除软链接 ===
#--- 文件夹软链接定义 ----
USER_SHARE="${TRIM_APPDEST}/share"
USER_CONFIG="${TRIM_DATA_SHARE_PATHS%%:*}/data"
USER_DOWNLOAD="${TRIM_DATA_SHARE_PATHS%%:*}/Download"
BITCOMET_SHARE="/usr/share/bitcomet"
BITCOMET_CONFIG="/root/.config/BitComet"
BITCOMET_DOWNLOAD="/root/Downloads"

# 检查并删除第一个软链接
if [ -L "${BITCOMET_SHARE}" ]; then
    if [ "$(readlink "${BITCOMET_SHARE}")" = "${USER_SHARE}" ]; then
        echo "发现并删除软链接: ${BITCOMET_SHARE} -> $(readlink "${BITCOMET_SHARE}")"
        rm -f "${BITCOMET_SHARE}"
    else
        echo "警告: ${BITCOMET_SHARE} 存在但不是由本脚本创建的 (目标: $(readlink "${BITCOMET_SHARE}")). 跳过。"
    fi
else
    echo "未找到软链接: ${BITCOMET_SHARE} (或它不是一个链接)"
fi

# 检查并删除第二个软链接
if [ -L "${BITCOMET_CONFIG}" ]; then
    if [ "$(readlink "${BITCOMET_CONFIG}")" = "${USER_CONFIG}" ]; then
        echo "发现并删除软链接: ${BITCOMET_CONFIG} -> $(readlink "${BITCOMET_CONFIG}")"
        rm -f "${BITCOMET_CONFIG}"
    else
        echo "警告: ${BITCOMET_CONFIG} 存在但不是由本脚本创建的 (目标: $(readlink "${BITCOMET_CONFIG}")). 跳过。"
     fi
else
    echo "未找到软链接: ${BITCOMET_CONFIG} (或它不是一个链接)"
fi

# 检查并删除第三个软链接
if [ -L "${BITCOMET_DOWNLOAD}" ]; then
    if [ "$(readlink "${BITCOMET_DOWNLOAD}")" = "${USER_DOWNLOAD}" ]; then
        echo "发现并删除软链接: ${BITCOMET_DOWNLOAD} -> $(readlink "${BITCOMET_DOWNLOAD}")"
        rm -f "${BITCOMET_DOWNLOAD}"
    else
        echo "警告: ${BITCOMET_DOWNLOAD} 存在但不是由本脚本创建的 (目标: $(readlink "${BITCOMET_DOWNLOAD}")). 跳过。"
    fi
else
    echo "未找到软链接: ${BITCOMET_DOWNLOAD} (或它不是一个链接)"
fi

    echo "已停止进程并清理软链接。"
# 获取用户在向导中的选择
WIZARD_DATA_ACTION="$wizard_data_action"

echo "卸载时，用户选择数据保留选项: $WIZARD_DATA_ACTION"

# 根据用户选择执行相应逻辑
if [ "$WIZARD_DATA_ACTION" = "delete" ]; then
    echo "开始删除数据目录：$TRIM_PKGVAR"
    rm -rf ${TRIM_PKGVAR} ${TRIM_DATA_SHARE_PATHS%%:*}
else
    echo "保留数据不动"
fi

exit 0